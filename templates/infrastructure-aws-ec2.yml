meta:
  environment: (( merge ))
  dns_root: (( merge ))
  security_groups: (( merge ))
  persistent_disk: 4096

  stemcell:
    name: bosh-aws-xen-ubuntu
    version: latest

  networks:
    app: default

  # unfortunately due to a missing feature we can't concat
  # string and int values using spiff, therefore we have to
  # repeat a line
  # see: https://github.com/cloudfoundry-incubator/spiff/pull/55 
  zookeepers:
    instances_int: (( merge || 3 ))
    instances_str: (( merge || "3"))
  stardog:
    instances: (( merge || 3 ))

jobs:
  - name: zookeeper_z1
    instances: (( meta.zookeepers.instances_int ))
    networks:
      - name: (( meta.networks.app ))
    persistent_disk: (( meta.persistent_disk ))
  - name: stardog_z1
    instances: (( meta.stardog.instances ))
    networks:
      - name: (( meta.networks.app ))
    persistent_disk: (( meta.persistent_disk ))

compilation:
  cloud_properties:
    instance_type: m1.small

resource_pools:
  - name: small_z1
    cloud_properties:
      instance_type: m1.small
  - name: default
    network: (( meta.networks.app ))
    stemcell:
      name: bosh-aws-xen-ubuntu-trusty-go_agent
      version: latest
    cloud_properties:
      instance_type: m1.small
      availability_zone: us-east-1a

properties:
  zookeeper:
    members: (( "<%= '['+(0..." meta.zookeepers.instances_str ").collect { |i| \"#{i}.zookeeper-z1.default.stardog-aws-ec2.microbosh\" }.join(\", \")+']' %>" ))
